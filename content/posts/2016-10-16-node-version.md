---
draft: false
title: a little node version
date: 2016-10-16 15:42:31
comments: true
---

å·¥ä½œä¸€èˆ¬ä½¿ç”¨ shipit ä½œä¸ºè‡ªåŠ¨éƒ¨ç½²çš„å·¥å…·. ä½†ä¹‹å‰ä¸€ç›´æœ‰ä¸ªé—®é¢˜ä¸èƒ½ç†è§£æ— æ³•è§£å†³, å°±æ˜¯è‡ªåŠ¨éƒ¨ç½²çš„æœ€åä¸€æ­¥
æ˜¯ä½¿ç”¨ [pm2](http://pm2.keymetrics.io/) å¯åŠ¨æœåŠ¡.

ä¹‹å‰è¿™ä¸€æ­¥ä¸€ç›´æ— æ³•æˆåŠŸ, æ¯æ¬¡ shipit åˆ° `pm2 restart SERVER` æ—¶å°±ä¼šæŠ¥é”™è¯´ `pm2 command not found`.
ä½†å¥‡æ€ªçš„æ˜¯ç›´æ¥ ssh ç™»å½•æœåŠ¡å™¨æ‰§è¡Œ `pm2 ls` æ˜¯å®Œå…¨ ok çš„, å¯ä»¥çœ‹åˆ°æ­£åœ¨è·‘çš„æœåŠ¡.
äºæ˜¯ä¹‹å‰æ¯æ¬¡éƒ½å¾ˆè ¢çš„æ‰‹åŠ¨æ‰§è¡Œæœ€åä¸€æ­¥.

è¿™ä¸¤å¤©å‘ç°å¦ä¸€ä¸ªæœåŠ¡å™¨çš„ node ç‰ˆæœ¬å¤ªä½, å„ç§æœ‰é—®é¢˜çš„æ—¶å€™, äºæ˜¯ç€æ‰‹æ›´æ–° node ç‰ˆæœ¬, è¿™ä¸ªè¿‡ç¨‹ä¸­å¿½ç„¶ç†è§£åˆ°ä¹‹å‰çš„é—®é¢˜å‡ºåœ¨å“ªé‡Œ.

## æ¥æ¥å»å»çš„ä¸€äº›ä¹±ä¸ƒå…«ç³Ÿçš„å°è¯•
é¦–å…ˆ node ç‰ˆæœ¬ç®¡ç†çš„å·¥å…·ä¸€èˆ¬å¯ä»¥ç”¨ [`nvm`](https://github.com/creationix/nvm) å’Œ `n` è¿™ä¸¤ä¸ª. éƒ½å¯ä»¥ä½¿ç”¨ `npm install -g nvm` è¿™ç§å½¢å¼å®‰è£…ä¸Š.

ä½†éœ€è¦ä½¿ç”¨ `npm install` é¦–å…ˆéœ€è¦å®‰è£… `npm` åŒ…, npm æœ¬èº«çš„ç‰ˆæœ¬ä¹Ÿæœ‰å¯èƒ½å¤ªä½, é‚£ä¹ˆå°±å…ˆæ›´æ–°å®ƒå§.

æŸ¥äº†[å®˜æ–¹æ–‡æ¡£](https://docs.npmjs.com/getting-started/installing-node), è¯´ç›´æ¥ `npm install npm@latest -g` å³å¯, ä½†æˆ‘å‘ç°å³ä½¿è¿™æ ·æ‰§è¡Œä¹‹å, `npm -v` ä»ç„¶æ˜¯ä¹‹å‰è¾ƒä½çš„ç‰ˆæœ¬å·.

åœ¨å„ç§ä¸èƒ½ç†è§£å, æˆ‘è§‰å¾—å¤§æ¦‚è¿˜æ˜¯å› ä¸º node æœ¬èº«ç‰ˆæœ¬å¤ªä½çš„é—®é¢˜. (å¦ˆè›‹, æå¾—åƒä¸ªæ­»å¾ªç¯ğŸ™„ğŸ™„ğŸ™„)

äºæ˜¯æˆ‘é¦–å…ˆä½¿ç”¨æœåŠ¡å™¨ä¸Šä»¥å‰å®‰è£…è¿‡çš„ `nvm` ä¸‹è½½äº† v4.6.0 ç‰ˆæœ¬çš„ node, `nvm use 4.6.0`åˆ‡åˆ°4.6.0ç‰ˆæœ¬ä¹‹å, é‡æ–°å®‰è£… pm2 å, shipit è‡ªåŠ¨éƒ¨ç½²ä»ç„¶ä¼šå‡ºé—®é¢˜.

ç„¶åæˆ‘åˆé‡æ–°ç ”ç©¶äº†ä¸€ä¸‹ shipit éƒ¨ç½²æ—¶æ‰“å°çš„ log, å‘ç°å…¶ä¸­æ‰§è¡Œçš„å‘½ä»¤ä¼šlog å‡º node ç‰ˆæœ¬, ç„¶è€Œ node ç‰ˆæœ¬å¹¶ä¸æ˜¯4.6.0, è€Œæ˜¯æ—§ç‰ˆæœ¬.

åˆ°è¿™é‡Œ, æˆ‘çªç„¶å°±æ˜ç™½äº†.

ç™»ä¸ŠæœåŠ¡å™¨ä»”ç»†çœ‹äº†çœ‹pm2ç©¶ç«Ÿè£…åœ¨äº†å“ªé‡Œ.....


## äº‹å®æ˜¯...

### first, shipit ä½¿ç”¨çš„ç³»ç»Ÿç‰ˆæœ¬çš„ node....
å¦‚æœç™»ä¸ŠæœåŠ¡å™¨, `nvm ls` çš„ç»“æœå¤§æ¦‚æ˜¯é•¿è¿™æ ·çš„:

```
             v4.6.0
    ->       system
    node -> stable (-> v4.6.0) (default)
    stable -> 4.6 (-> v4.6.0) (default)
    iojs -> iojs- (-> N/A) (default)
```

ä¹Ÿå°±æ˜¯ç°åœ¨ä½¿ç”¨çš„ system ä¸­çš„ node, `node -v` å°±å¯ä»¥ç›´æ¥çŸ¥é“æ‰€è°“ç³»ç»Ÿç‰ˆæœ¬çš„node æ˜¯å¾ˆä½çš„,
è€Œå¦‚æœåˆ‡æ¢åˆ°4.6.0, å®‰è£… pm2 å, pm2 å¹¶ä¸ä¼šåœ¨ç³»ç»Ÿ node ç‰ˆæœ¬ä¸­å­˜åœ¨, è€Œæ˜¯åœ¨ `~/.nvm/versions/node/v4.6.0/lib/node_modules`
è¿™æ ·ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹. åŒç†, å¦‚æœå†ä½¿ç”¨ nvm å®‰è£…å…¶ä»–ç‰ˆæœ¬çš„ node, å†æ¬¡å®‰è£…å…¶ä»– package, é‚£ä¹ˆå®ƒä»¬
çœŸæ­£æ‰€åœ¨çš„ä½ç½®åº”è¯¥æ˜¯ `~/.nvm/versions/node/<version>/lib/node_modules`.

### è€Œç³»ç»Ÿ node ç‰ˆæœ¬ä¸­å®‰è£…çš„åŒ…åœ¨....
åœ¨è¿™ä¸ª`/usr/local/lib/node_modules`æ–‡ä»¶å¤¹ä¸‹.

æ€»çš„æ¥è¯´, å°±æ˜¯ç¬¬ä¸€æ¬¡å®‰è£…çš„ node ç‰ˆæœ¬å°±æ˜¯æ‰€è°“çš„ç³»ç»Ÿç‰ˆæœ¬, æ¯•ç«Ÿæœ‰äº†ç¬¬ä¸€æ¬¡å®‰è£…çš„ npm, æ‰ä¼šå»å®‰è£… nvm ä¹‹ç±»çš„å·¥å…·.
å›°æ‰°æˆ‘çš„é—®é¢˜ç»ˆäºææ¸…æ¥šäº†, nvm å…¶å®æ˜¯æ— æ³•å¹²æ¶‰åˆ°ç³»ç»Ÿç‰ˆæœ¬çš„.

(è¯è¯´çªç„¶æƒ³åˆ° pyenv è²Œä¼¼åŸç†ä¹Ÿæ˜¯ç±»ä¼¼çš„?......ğŸ¤”)

è§£å†³æœ€å¼€å§‹çš„éƒ¨ç½²é—®é¢˜çš„è¯, å…¶å®å¾ˆç®€å•, å°±æ˜¯åœ¨system nodeä¸­é‡æ–°å®‰è£…pm2, `npm install -g pm2` æå®š

## é‚£æ€ä¹ˆæ›´æ–° system node ç‰ˆæœ¬å‘¢

åœ¨æˆ‘å‘ç°äº† nvm å’Œ n å…¶å®éƒ½æ— æ³•ç®¡ç†ç³»ç»Ÿç‰ˆæœ¬å, æˆ‘æ‰ç»ˆäºå‘ç°å…¶å®å›åˆ°æœ€åŸå§‹çš„ç¬¬ä¸€æ¬¡å®‰è£…åº”è¯¥æ€ä¹ˆå®‰è£…å°±å†å®‰è£…ä¸€æ¬¡å°±å¥½,
å®ƒä¼šè‡ªåŠ¨åˆ é™¤æ—§ç‰ˆæœ¬, æ˜¯çœŸçš„åˆ é™¤æ—§ç‰ˆæœ¬....[å®˜æ–¹æ–‡æ¡£](https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions)

```
# å®‰è£… 4.x ç‰ˆæœ¬
curl -sL https://deb.nodesource.com/setup_4.x | sudo -E bash -
sudo apt-get install -y nodejs
```

```
# å®‰è£… 6.x ç‰ˆæœ¬
curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -
sudo apt-get install -y nodejs
```

è¿™æ ·æ‰èƒ½çœŸçš„æ›´æ–° system node ç‰ˆæœ¬....ğŸ˜‚
æ›´æ–° node ç‰ˆæœ¬åå†æ›´æ–° npm, æœ€åå¯ä»¥ä½¿ç”¨ `npm update` ä¸€é”®æ›´æ–°æ‰€æœ‰ä¹‹å‰å®‰è£…çš„åŒ…åˆ°æœ€æ–°ç‰ˆæœ¬.

å“¦å•Š, å‰é¢å¿˜äº†è¯´, æœåŠ¡å™¨æ˜¯ ubuntu.


## Last
ç‰ˆæœ¬é—®é¢˜æœç„¶ä¼šå¾ˆæ··ä¹±.....ğŸ™ƒ
