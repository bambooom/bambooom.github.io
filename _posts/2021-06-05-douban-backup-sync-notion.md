---
layout: post
title: è±†ç“£æ ‡è®°å¯¼å‡ºåˆ° Notion å¹¶åŒæ­¥
date: 2021-06-05
disqus: y
---

æˆ‘ä¸ªäººçš„è±†ç“£æ ‡è®°æ¡ç›®å¯¼å‡ºåˆ° Notion å¹¶åŒæ­¥çš„ä¸€å¥—æ“ä½œå’Œå·¥å…·ï¼Œå¹¶ä¸é€‚ç”¨äºŽæ‰€æœ‰äººã€‚å¹¶ä¸”å¯èƒ½è¿˜æœ‰é—®é¢˜æ²¡æœ‰å‘çŽ°ã€‚

## 1. ä½¿ç”¨æ²¹çŒ´è„šæœ¬ä¸€é”®å¯¼å‡º`çœ‹è¿‡/è¯»è¿‡/å¬è¿‡`çš„ç”µå½±ã€ä¹¦ã€éŸ³ä¹æ¡ç›®

è„šæœ¬ -> [è±†ç“£è¯»ä¹¦+ç”µå½±+éŸ³ä¹å¯¼å‡ºå·¥å…·](https://greasyfork.org/en/scripts/420999-%E8%B1%86%E7%93%A3%E8%AF%BB%E4%B9%A6-%E7%94%B5%E5%BD%B1-%E9%9F%B3%E4%B9%90%E5%AF%BC%E5%87%BA%E5%B7%A5%E5%85%B7)

æ˜¯æˆ‘ä»Žå¦å¤–ä¸€ä¸ªå‹é‚»çš„è„šæœ¬å®Œå–„ä¿®æ”¹çš„ï¼Œå®‰è£…åŽä¼šåœ¨è‡ªå·±çš„è±†ç“£é¡µé¢ä¸Šçœ‹åˆ°å¤šå‡ºä¸‰ä¸ªé“¾æŽ¥ï¼š

![](/assets/images/douban-backup-monkey-script.png)

åˆ†åˆ«ç‚¹å‡»è¿™ä¸‰ä¸ªé“¾æŽ¥å°±ä¼šåˆ†åˆ«ä»Ž `https://movie.douban.com/mine?status=collect`, `https://music.douban.com/mine?status=collect`, `https://book.douban.com/mine?status=collect` è¿™ä¸‰ä¸ªåœ°æ–¹è‡ªåŠ¨ç¿»é¡µåŽ»èŽ·å–ä¸ªäººæ ‡è®°æ•°æ®ï¼ˆåŒ…æ‹¬è¯„åˆ†ã€è¯„åˆ†æ—¶é—´ä»¥åŠçŸ­è¯„ï¼‰å¹¶æœ€ç»ˆå¯¼å‡º csv æ–‡ä»¶ã€‚æ¯æ¬¡éƒ½å¯èƒ½éœ€è¦ä¸€ç‚¹æ—¶é—´ç»™è„šæœ¬åŽ»ç¿»é¡µèŽ·å–æ•°æ®ï¼Œä¸­é€”ä¸è¦å…³æŽ‰æµè§ˆå™¨ï¼Œä¹Ÿä¸è¦åœ¨è¿™ä¸ªé¡µé¢ä¸ŠåŽ»æ“ä½œä»€ä¹ˆã€‚

å› ä¸ºè¿™ä¸‰ä¸ªåœ°æ–¹ä¸æ˜¯å…·ä½“æ¡ç›®é¡µé¢ï¼Œæ‰€ä»¥é¡µé¢è®¿é—® limit request å¹¶ä¸ä¸¥æ ¼ï¼Œæ‰€ä»¥è¿™æ ·è·‘è„šæœ¬å®Œå…¨ä¸ä¼šè¢«å½“åšæœºå™¨äººè€Œé­åˆ°å°ç¦ IP æˆ–è¦æ±‚é‡æ–°ç™»å½•ä¹‹ç±»çš„å¤„ç†ã€‚
ä½†å±€é™ä¹Ÿå°±æ˜¯è¿™é‡Œæ— æ³•å‡†ç¡®èŽ·å–æ›´å¤šæœ‰å…³æ¡ç›®æœ¬èº«çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç”µå½±æ¡ç›®çš„ IMDb é“¾æŽ¥ã€åˆ¶ç‰‡å›½å®¶ï¼Œä¹Ÿæ— æ³•ç²¾å‡†æŠŠå¯¼æ¼”å’Œæ¼”å‘˜ä¹‹ç±»çš„äººååŒºåˆ†å¼€ã€‚

## 2. åœ¨ Notion åˆ›å»º database å¹¶å¯¼å…¥ csv

åœ¨ Notion ä¸­æ–°å»ºä¸€ä¸ª databaseï¼Œä¹Ÿå°±æ˜¯è¡¨æ ¼ã€‚ç„¶åŽç»™è¡¨æ ¼è®¾ç½®æ¯ä¸€åˆ—çš„ Property åå­—å’Œç±»åž‹ï¼Œåå­—éœ€è¦å¯¹åº”å‰é¢å¯¼å‡ºçš„ csv çš„è¡¨å¤´çš„åå­—å’Œé¡ºåºã€‚

ä¾‹å¦‚æˆ‘çš„æ²¹çŒ´è„šæœ¬å¯¼å‡ºçš„ csv æ˜¯è¿™æ ·çš„:

| æ ‡é¢˜                  | ä¸ªäººè¯„åˆ† | æ‰“åˆ†æ—¥æœŸ   | æˆ‘çš„çŸ­è¯„                                                   | ä¸Šæ˜ æ—¥æœŸ   | åˆ¶ç‰‡å›½å®¶ | æ¡ç›®é“¾æŽ¥                                   |
| --------------------- | -------- | ---------- | ---------------------------------------------------------- | ---------- | -------- | ------------------------------------------ |
| éŸ³ä¹ / éŸ³æ¥½           |          | 2021/05/22 |                                                            | 2019/09/26 | åŠ æ‹¿å¤§   | https://movie.douban.com/subject/34429100/ |
| çŽ‹è€…å¤©ä¸‹ / ã‚­ãƒ³ã‚°ãƒ€ãƒ  | 2        | 2021/05/19 | å¤ªéš¾çœ‹äº†ï¼ŒçœŸæ˜¯é€‚åˆé£žæœºä¸Šæ‰“å‘æ—¶é—´ï¼Œåªæœ‰éº»é…±å¤ªç¾Žå¤ªå¸…äº†ï¼ï¼ï¼ | 2019/04/19 | æ—¥æœ¬     | https://movie.douban.com/subject/27611498/ |

å¦‚æžœä¸å–œæ¬¢è¿™ä¸ªé¡ºåºï¼Œå¯ä»¥è‡ªå·±ç”¨ excel æˆ– wps ä¹‹ç±»çš„å·¥å…·æ‰“å¼€è°ƒæ•´é¡ºåºåŽå†é‡æ–°å¯¼å‡º csv æ–‡ä»¶ã€‚

ç„¶åŽåœ¨ Notion é¡µé¢éƒ½å³ä¸Šè§’èœå•æ‰“å¼€åŽé€‰æ‹© Merge with CSV å¹¶é€‰æ‹©è¿™ä¸ª csv æ–‡ä»¶åŽç¨ç­‰ç‰‡åˆ»å³å¯å®Œæˆå¯¼å…¥ã€‚

![](/assets/images/douban-backup-notion-merge-csv.png)

å¯¼å…¥åŽå¤§è‡´æ•ˆæžœï¼š

![](/assets/images/douban-backup-notion-db.png)


## 3. ä½¿ç”¨ GitHub Actions å®šæ—¶ä»Ž RSS ä¿¡æ¯å°†è±†ç“£æ ‡è®°æ›´æ–°åŒæ­¥åˆ° Notion

è™½ç„¶å°½é‡æŠŠè±†ç“£æ ‡è®°æ¡ç›®å¤‡ä»½å¯¼å‡ºäº†ï¼Œä½†å¹¶æ²¡æœ‰æ‰“ç®—å®Œå…¨ä¸ç”¨è±†ç“£äº†ï¼Œæ¯•ç«Ÿçš„ç¡®æ²¡æœ‰å®Œç¾Žçš„æ›¿ä»£ï¼Œè¿™é‡Œçš„å‹é‚»ä¹Ÿéƒ½ä¾ç„¶æ˜¯æˆ‘å–œæ¬¢å’ŒæœŸæœ›çœ‹åˆ°çš„ã€‚
æ‰€ä»¥ä¸Šé¢ä¸¤æ­¥å…¶å®žæˆ‘ 4 ä¸ªæœˆå‰å°±åšå¥½äº†çš„ï¼Œä½†å¯¹æˆ‘æ¥è¯´æœ€å¤§çš„å›°æ‰°æ˜¯å¦‚ä½•åœ¨ä¸Šé¢çš„æ“ä½œä¹‹åŽç»§ç»­åŒæ­¥æ ‡è®°å‘¢ï¼Ÿ
æ¯ä¸ªæ¡ç›®éƒ½æ‰‹åŠ¨è¾“å…¥çš„è¯å¯å¤ªéº»çƒ¦äº†ï¼Œé‚£æ¯æ¬¡éƒ½ä»Žè±†ç“£é‡æ–°å¯¼å‡º csv å†å°†æ–°çš„æ¡ç›®åˆå¹¶è¿› Notion æ“ä½œèµ·æ¥ä¼¼ä¹Žä¹Ÿå¾ˆéº»çƒ¦ã€‚

> å‰ä¸¤æ­¥è¿˜æ˜¯æ¯”è¾ƒå‚»ç“œå¼æ“ä½œçš„ï¼ŒåŸºæœ¬ä¸Šå¤§å¤šæ•°äººéƒ½å¯ä»¥è½»æ˜“å®Œæˆï¼Œä½†è¿™ä¸ªç¬¬ä¸‰æ­¥å°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚ä¸€å®šéœ€è¦çš„æ˜¯ GitHub è´¦å·ï¼Œå¦‚æžœä¸ä¼šæŠ˜è…¾ï¼Œä¹Ÿå¯ä»¥å¦‚æˆ‘ä¸Šé¢è¯´çš„ï¼Œéš”ä¸€æ®µæ—¶é—´é‡æ–°è·‘ä¸€ä¸‹å¯¼å‡ºè„šæœ¬ï¼Œç¼ºç‚¹æ˜¯å¾—è‡ªå·±æ‰‹åŠ¨æ“ä½œæŠŠå·²å¯¼å…¥çš„éƒ¨åˆ†åŽ»æŽ‰ï¼Œç„¶åŽå°†åŒ…å«å‰©ä½™éƒ¨åˆ†çš„ csv æ–‡ä»¶å†æ¬¡å¯¼å…¥åˆ° Notion ä¸­å³å¯ã€‚

åŽæ¥æˆ‘æƒ³åˆ°çš„ä¸€ä¸ªæ–¹æ³•æ˜¯é€šè¿‡ RSSï¼Œæ‰€å¹¸è¿™ä¹ˆå¤šå¹´è¿‡åŽ»äº†ï¼Œgoogle reader éƒ½æ­»æŽ‰äº†ï¼Œè±†ç“£çš„ RSS ä¾ç„¶è¿˜ä¿ç•™ç€ã€‚
åœ¨ä¸ªäººé¡µé¢çš„å³ä¸‹è§’ä¸€ç›´å®‰é™åœ°å­˜åœ¨ç€ï¼š

![](/assets/images/douban-rss.png)

ä»¥[æˆ‘çš„è´¦å·çš„ RSS ä¿¡æ¯](https://www.douban.com/feed/people/MoNoMilky/interests)ä¸ºä¾‹ï¼Œ
è¿™ä¸ª feed é‡Œåªæœ‰ä¹¦å½±éŸ³çš„æ ‡è®°ä¿¡æ¯ï¼Œå¹¶ä¸”æƒ³çœ‹ã€åœ¨çœ‹ã€çœ‹è¿‡ä¸‰ç±»çŠ¶æ€çš„ä¿¡æ¯ä¹Ÿéƒ½åŒ…æ‹¬ã€‚ç¼ºç‚¹æ˜¯ä»…æœ‰ä¿ç•™æœ€æ–°çš„ 10 æ¡ä¿¡æ¯ã€‚

æ‰€ä»¥æˆ‘ä¸ªäººçš„æ–¹æ³•æ˜¯å®šæ—¶è¯»å–è¿™ä¸ª RSS feedï¼Œç„¶åŽä»Žä¸­å°†æ–°çš„æ ‡è®°ä¿¡æ¯è‡ªåŠ¨æ›´æ–°åˆ° Notion é‡ŒåŽ»ï¼Œå°±å¾ˆæ–¹ä¾¿äº†ã€‚
è¿™ä¸ªæƒ³æ³•åœ¨ 4 ä¸ªæœˆå‰å°±åŸºæœ¬æˆåž‹äº†ï¼Œä½†ç­‰åˆ° Notion æä¾› Public API ä¹‹åŽæ‰ç»ˆäºŽèƒ½å¤Ÿå®žçŽ°äº†ã€‚

å®Œæˆçš„è„šæœ¬ -> [sync-rss.js](https://github.com/bambooom/douban-backup/blob/main/sync-rss.js) å°±æ˜¯åšäº†ä¸Šè¿°äº‹é¡¹ï¼Œå…¶ä¸­ä¹Ÿé¡ºä¾¿é’ˆå¯¹æ¯ä¸ªæ–°çš„æ¡ç›®åŽ»æ¡ç›®é¡µé¢æˆªå–äº†æ›´å¤šæˆ‘æƒ³è¦ä¿ç•™çš„ä¿¡æ¯ï¼Œå› ä¸ºæ•°é‡å¾ˆå°‘æ‰€ä»¥ä¹Ÿä¸ä¼šå¼•å‘è¢«å°é” IPã€‚ï¼ˆä»£ç å†™çš„å¾ˆ uglyï¼Œå‡‘åˆèƒ½ç”¨å§ðŸ˜‚ ï¼‰

æƒ³è¦æˆåŠŸä½¿ç”¨è¿™ä¸ªè„šæœ¬ï¼Œéœ€è¦åšå‡ ä»¶äº‹ï¼š

1. æ³¨å†Œä¸€ä¸ª GitHub è´¦å·
2. fork æˆ‘çš„ä»£ç ä»“åº“ https://github.com/bambooom/douban-backup ï¼ˆæ‡‚çš„äººä¹Ÿå¯ä»¥ä¸ forkï¼‰
3. æŒ‰ç…§ [Notion æ–‡æ¡£](https://developers.notion.com/docs/getting-started) æ³¨å†Œä¸€ä¸ª Integrationï¼Œå«ä»€ä¹ˆåå­—éšæ„ï¼ŒèŽ·å– Token
4. åœ¨ä½ å‰é¢åˆ›å»ºçš„ database é¡µé¢é‚€è¯· Integrationï¼ˆæŠŠå®ƒæƒ³æˆä¸€ä¸ª botï¼‰ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ä½¿ç”¨ Notion API Token æ¥è®¿é—®æˆ–è€…æ›´æ–° Notion äº†ã€‚è¦æ³¨æ„çš„æ˜¯æ¯ä¸ª database éƒ½éœ€è¦å•ç‹¬é‚€è¯· Integration
5. åœ¨è‡ªå·± fork æˆ–åˆ›å»ºçš„ä»£ç ä»“åº“é‡Œè®¾ç½® secretsï¼Œkey çš„åå­—å¦‚å›¾ï¼ŒNOTION_TOKEN å³ç¬¬ä¸‰æ­¥èŽ·å–çš„ Tokenï¼ŒNOTION_BOOK/MOVIE/MUSIC_DATABASE_ID æ˜¯ä½ è‡ªå·±çš„æ•°æ®åº“çš„ IDï¼Œåœ¨ Notion ç½‘ç«™çš„ URL ä¸Šå³å¯å¤åˆ¶ ï¼ˆå‰é¢çš„ Notion æ–‡æ¡£ä¸­ä¹Ÿæœ‰æåˆ°ä»€ä¹ˆæ˜¯ database IDï¼‰

![](/assets/images/douban-backup-secrets.png)

```
https://www.notion.so/myworkspace/a8aec43384f447ed84390e8e42c2e089?v=...
                                  |--------- Database ID --------|
```

    å¦‚æžœæ˜¯æ‡‚è‡ªå·±åœ¨å¹²ä»€ä¹ˆçš„äººï¼Œæƒ³è¦åœ¨è‡ªå·±ç”µè„‘ä¸Šè·‘è„šæœ¬çš„è¯ï¼Œéœ€è¦åœ¨ä»“åº“ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªå« `.env` çš„æ–‡ä»¶é…ç½®é½ä¸‹é¢çš„ secrets å³å¯

æœ€åŽè¿™ä¸ªè„šæœ¬éœ€è¦å®šæ—¶è·‘ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª cron job è€Œå·²ï¼Œåˆç©·åˆæ‡’çš„æˆ‘ï¼Œå‘çŽ°äº† GitHub è¿‘æ¥åœ¨æŽ¨çš„è‡ªå®¶çš„ Actions åŠŸèƒ½æ˜¯å¯ä»¥åšå®šæ—¶ä»»åŠ¡çš„ï¼Œ[å‚è€ƒæ–‡æ¡£](https://docs.github.com/en/actions/reference/events-that-trigger-workflows#scheduled-events)ã€‚
å…è´¹ç”¨æˆ·çš„å…¬å¼€ä»“åº“ä¼¼ä¹Žä¹Ÿå®Œå…¨ä¸é™åˆ¶ Actions çš„ä½¿ç”¨ï¼ˆPrivate repo æ˜¯æœ‰é™åˆ¶ä½¿ç”¨åˆ†é’Ÿæ•°çš„ï¼‰ï¼Œæ‰€ä»¥æˆ‘åœ¨ä»“åº“é‡Œæ·»åŠ äº†è¿™ä¸ª [workflow è®¾ç½®æ–‡ä»¶](https://github.com/bambooom/douban-backup/blob/main/.github/workflows/sync-rss.js.yml)ã€‚
æˆ‘è®¾ç½®çš„æ˜¯æ¯ 6 ä¸ªå°æ—¶è·‘ä¸€æ¬¡ï¼Œå› ä¸ºæˆ‘çš„æ ‡è®°ä¹Ÿæ²¡æœ‰é‚£ä¹ˆé¢‘ç¹ï¼Œåº”è¯¥æ˜¯å¤Ÿç”¨äº†çš„ã€‚

æœ€ç»ˆ -> [æˆ‘çš„ Notion ä¹¦å½±éŸ³ database](https://www.notion.so/f6ff9481e3c044b09d9a46645e92d5b8)
